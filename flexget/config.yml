# email:
#   from: someuser@gmail.com
#   to:
#     - someuser@gmail.com
#   smtp_host: smtp.gmail.com
#   smtp_port: 587
#   smtp_username: someuser@gmail
#   smtp_password: XXXXXXX
#   smtp_tls: yes
#   template: html
tasks:
  # downloading task
  download-rss:
    # RSS where everything is downloaded from:
    rss: CONFIG_RSS_FEED
    # fetch all the feed series
    all_series: yes
    # use transmission to download the torrents
    transmission:
      host: localhost
      port: 9091
      username: transmission
      password: transmission
      path: /home/osmc/Downloads
  # Remove completed downloads from Transmission
  clean_transmission:
      host: localhost
      port: 9091
      username: transmission
      password: transmission
      finished_for: 1 hours
  # sorting task
  sort-files:
    find:
      # directory with the files to be sorted
      path: /home/osmc/Downloads/
      # fetch all avi, mkv and mp4 files, skips the .part files (unfinished torrents)
      regexp: '.*\.(avi|mkv|mp4)$'
      recursive: yes
    accept_all: yes
    seen: local
    # this is needed for the episode names
    thetvdb_lookup: yes
    all_series:
      # for some reason all_series rejects all episodes here, even with seen: local, so parse_only must be added
      parse_only: yes
    # TVDB doesn't recognise "Adventure Time with Finn and Jake" so you must add such exceptions here manually
    series:
      - Adventure Time
    move:
      # this is where the series will be put
      to: /home/osmc/TV Shows/{{ tvdb_series_name }}/Season {{ tvdb_season }}
      # save the file as "Series Name - SxxEyy - Episode Name.ext"
      filename: '{{ tvdb_series_name }} - {{ series_id }} - {{ tvdb_ep_name }}{{ location | pathext }}'
    # Download subtitles of the Series. Change "es" if you don't want Spanish
    exec:  /usr/local/bin/periscope -l es "/home/osmc/TV Shows/{{ tvdb_series_name }}/Season {{ tvdb_season }}/{{ tvdb_series_name }} - {{ series_id }} - {{ tvdb_ep_name }}{{ location | pathext }}"
